> 高性能固态盘的多级并行性及算法研究---胡洋
>
> 针对该论文的学习总结

# 第二节---固态盘的并行性

[TOC]



### 四层并行性



假设有两个通道，每个通道有两个芯片，每个芯片有两个晶圆，每个晶圆有两个分组。

![image-20200727154203227](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200727154203227.png)

------

命令地址传输时间很短忽略不计（途中出现仅仅作为标志），数据传输的时间开销为5个单位时间，读介质时间开销为2个单位时间，写介质时间开销为20个单位时间。

![image-20200727154009259](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200727154009259.png)

##### 

#### 通道之间的并行

![image-20200727154342306](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200727154342306.png)



#### 芯片之间的并行

![image-20200727154528371](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200727154528371.png)

#### 晶圆之间的并行

![image-20200727154538555](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200727154538555.png)

#### 分组之间的并行

！！！分组之间的并行性是完全并发，不同于以上三种的并行（类似于流水线处理）

![image-20200727154656637](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200727154656637.png)



### 并行性与高级命令

#### 内部数据迁移命令

- 原理作用：对于高并行性的SSD，常常发现占用比例最高的是通道。芯片等的性能受到通道的限制。但是我们可以发现对于和主机没有交互的操作（内部数据的迁移），完全可以不占用通道的流量，从而提高性能。

- 限制：

  1. 使用改命令要求目标的物理页地址的奇偶性相同（猜测：当高电位集中分布时会导致数据错误）
  2. 同一个物理块内的空闲地址必须连续使用。

-  导致的问题：![image-20200727161112234](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200727161112234.png)

  第1217页没有使用直接被标记为失效，造成浪费。

-  对存在问题的两种解决方案：

  1. 有条件的使用，不发生有效页的浪费。
  2. 无条件的使用（贪婪的使用），任何情况下都使用内部迁移指令。

-  结论：方案二即无条件使用一般导致性能的下降，方案一在某些情况下可以提升性能。方案二的优化达不到预期效果是因为产生过多的失效页，导致垃圾回收次数的增加，同时垃圾回收又使用内部数据迁移命令，进一步产生大量失效页，引发恶性循环。![image-20200727162451064](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200727162451064.png)

#### 多分组操作指令

-  原理作用：利用分组之间的并行性。假设有两个写操作，直接将两个写数据读入某一晶圆的寄存器中，之后再将两个数据同时写入物理页中。
- 限制：
  1. 并行的数据必须写入不同分组中具有相同物理块号，物理页号中
  2. 同一个物理块内的空闲地址必须连续使用。
-  存在的问题：![image-20200727164122872](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200727164122872.png)
-  对存在问题的两种解决方案（失效页的统一处理方案）：
  1. 有条件的使用，不发生有效页的浪费。
  2. 无条件的使用（贪婪的使用），任何情况下都使用内部迁移指令。
-  结论：`与上一条指令结论相反，对性能的优化超过触发垃圾回收的性能损耗。

#### 交错操作命令

- 原理作用：多个晶圆之间的并行（见图2.5）流水操作
- 限制：并行的指令操作在同个芯片的不同晶圆下。
- 结论：所以情况下都可以提高性能，且对磨损几乎没有影响，因此贪婪的使用交错操作指令。![image-20200727165835938](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200727165835938.png)

#### 综合使用高级命令

- 目的：提高并行性

- 三种方案：

  1. 不采用高级命令
  2. 有条件的使用内部和多分组命令，贪婪的使用的交错命令
  3. 有条件的使用内部数据迁移命令，贪婪的使用多分组和交错命令

- 结论：![image-20200727170522240](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200727170522240.png)

  方案3对性能提高最好；方案2性能提升不如方案3，但是其对擦写次数没有增加。综上，对性能敏感时，用方案3；重视SSD寿命时采用方案2.

#### 并行度优先级

- 作用：不同层级的并行存在相互影响的情况，为了使带宽充分利用必须尽可能的让每个器件的使用效率达到最高。

- 排序：通道并行>分组并行>晶圆并行>芯片并行

- > 为保证通道占用率通道优先级最高。
  >
  > 当一个写请求需要写个物理，以晶圆并行也可以分组并行，如图![image-20200728102101042](C:\Users\yangyiming\AppData\Roaming\Typora\typora-user-images\image-20200728102101042.png)将总线传输阶段细分成传输命令地址阶段和数传输阶段，相比分组并行，晶圆并行效率更高。多分组采用会导致有效页的损失，但是晶圆的并行只是交错命令，不会导致有效页的损失。

